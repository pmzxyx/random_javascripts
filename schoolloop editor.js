var NAME="Schoolloop Editor",URL=window.location.href.split(/\/+|\./),HTTP=URL[0];URL[4]&&"progress_report"==URL[4]||(URL[4]&&"schoolloop"==URL[2]&&"com"==URL[3]?alert("You must be on a progress report for "+NAME+" to work"):alert("You must be on schoolloop for "+NAME+" to work"));var pageConstants={weightTitle:"Weight",weightScoreTitle:"Weight Score"},constants={assignmentCategory:"category",assignmentDate:"date",assignmentMaxScore:"maxScore",assignmentName:"name",assignmentStudentScore:"studentScore",homeURL:"wilcox.schoolloop.com/portal/student_home",notBuilt:-1,stdURL:"wilcox.schoolloop.com",weightTitle:"Weight",weightsCategory:"Category",weightScoreTitle:"Weight Score",weightsWeight:"Weight"},Retriever={getScoresTitles:function(){return document.getElementsByClassName("module_content")[0].getElementsByTagName("tr")[0]},getScoresContent:function(){var t=document.getElementsByClassName("module_content")[0].getElementsByTagName("tr");return(t=[...t]).shift(),t},getScoresAttrOf:function(t){for(var e=[],n=0;n<t.children.length;n++)e[n]=t.children[n].innerHTML.replace(":","");return e},getScoresAttr:function(){var t=this.getScoresTitles();return this.getScoresAttrOf(t)},scoresCategoryCollection:function(){for(var t=[],e=this.getScoresContent(),n=this.getScoresAttr(),i=0;i<e.length;i++){t[i]={};for(var s=e[i],r=0;r<s.children.length;r++)t[i][n[r]]=s.children[r].innerHTML}return t},getGradeLegendTbl:function(){return document.getElementsByClassName("module_content")[2]},getGradeLegendCodesOf:function(t){for(var e=[],n=t.children[0].children[0].children,i=1;i<n.length;i++)e[i-1]=n[i].children[0].innerText.split(":")[0];return e},getGradeLegendCodes:function(){var t=this.getGradeLegendTbl();return this.getGradeLegendCodesOf(t)},getAssignmentTbl:function(){return document.getElementsByClassName("general_body")[0]},getAssignmentCategory:function(t){return t.children[0].children[0].innerText.split("\n")[0].trim()},getAssignmentName:function(t){return t.children[0].children[0].innerText.split("\n")[1].trim()},getAssignmentNameElement:function(t){return t.children[0].children[0]},getAssignmentScoreMax:function(t){var e=t.children[3].innerText;return e.split("/")[1]&&e.split("/")[1].split(" ")[1]?parseFloat(e.split("/")[1].split(" ")[1]):0},getAssignmentScore:function(t){return parseFloat(t.children[3].children[0].innerText.split(" ")[1])?parseFloat(t.children[3].children[0].innerText.split(" ")[1]):0},getAssignmentCollection:function(){for(var t=[],e=this.getAssignmentTbl(),n=0;n<e.children.length;n++)t[n]={},t[n][constants.assignmentCategory]=this.getAssignmentCategory(e.children[n]),t[n][constants.assignmentName]=this.getAssignmentName(e.children[n]),t[n][constants.assignmentMaxScore]=this.getAssignmentScoreMax(e.children[n]),t[n][constants.assignmentStudentScore]=this.getAssignmentScore(e.children[n]);return t},getCurrentClassName:function(){return document.getElementsByClassName("label1")[0].innerHTML.replace(":","")},getNewAssignments:function(t){var e=new XMLHttpRequest;e.open("GET",HTTP+"//"+constants.homeURL),e.wantedClass=this.getCurrentClassName(),e.assignmentCount=0,e.dest=t,e.onload=function(){this.parser=new DOMParser;var t=this.parser.parseFromString(this.response,"text/html").getElementsByClassName("ajax_accordion_row jsTrackerRefresh");this.assignmentCount=this.retAssignments=0,this.assignments=[];for(var e=0;e<t.length;++e){var n=t[e];n.children[1].children[0].children[0].children[4].innerHTML.match(/\S+.{1,}/)[0]==this.wantedClass&&(n.idNum=this.assignmentCount,this.assignments[n.idNum]={},this.assignments[n.idNum][constants.assignmentName]=n.children[1].children[0].children[0].children[3].children[0].innerHTML.match(/\S+.{1,}/)[0],this.assignments[n.idNum][constants.assignmentDate]=n.children[1].children[0].children[0].children[5].innerHTML.match(/(\S+.{1,})/)[0].replace("Due: ",""),n.request=new XMLHttpRequest,n.request.homeReq=this,n.request.idNum=n.idNum,n.request.open("GET",HTTP+"//"+constants.stdURL+n.children[0].attributes[2].nodeValue),n.request.onload=function(){var t=this.homeReq.parser.parseFromString(this.response,"text/html"),e=t.getElementsByClassName("text")[3]?parseFloat(t.getElementsByClassName("text")[3].innerText.match(/(\S+.{1,})/)[0]):0,n=t.getElementsByClassName("text")[4]?t.getElementsByClassName("text")[4].innerText.match(/(\S+.{1,})/)[0]:0;this.homeReq.assignments[this.idNum][constants.assignmentMaxScore]=e,this.homeReq.assignments[this.idNum][constants.assignmentCategory]=n,++this.homeReq.retAssignments==this.homeReq.assignmentCount&&(this.homeReq.dest.newAssignments=this.homeReq.assignments,this.homeReq.dest.loadedNewAssignments())},n.request.send(),++this.assignmentCount)}},e.send()}},DataHandling={findTotalWeightOf:function(t){if(!t||0==t.length||!t[0][constants.weightTitle])return -1;for(var e=0,n=0;n<t.length;n++)e+=parseFloat(t[n][constants.weightTitle]);return e},Category:function(){this.weight=0,this.cat="",this.studentPoints=0,this.maxPoints=0},findCategoryPointsOf:function(t,e){for(var n=[],i=0;i<e.length;i++)if(n[i]=new this.Category,e[i][constants.weightsCategory]?n[i].cat=e[i][constants.weightsCategory]:n[i].cat=i+"?",e[i][constants.weightsWeight]){var s=parseFloat(e[i][constants.weightsWeight]);s||(s=0),n[i].weight=s}else n[i].weight=i+"?";for(var i=0;i<t.length;i++)for(var r=t[i][constants.assignmentCategory],a=t[i][constants.assignmentStudentScore],o=t[i][constants.assignmentMaxScore],h=0;h<n.length;h++)r==n[h].cat&&(n[h].maxPoints+=o,n[h].studentPoints+=a);return n},calculateTotalGrade:function(t,e,n){var i=[];if(e){for(var s=0;s<n.categoryChecks.length;s++)if(n.categoryChecks[s].checked)for(var r=n.categoryChecks[s].id,a=0;a<t.categoryPoints.length;a++)t.categoryPoints[a].cat==r&&i.push(t.categoryPoints[a])}else for(var s=0;s<t.categoryPoints.length;s++)i.push(t.categoryPoints[s]);if(0==i.length)return 0;if("string"!=typeof i[0].weight){for(var o=0,h=0,s=0;s<i.length;s++){if(0==i[s].maxPoints){if(0==i[s].studentPoints)continue;i[s].maxPoints=1}o+=i[s].weight,h+=i[s].studentPoints/i[s].maxPoints*(i[s].weight/100)}return h*(1/o)*100}for(var l=0,d=0,s=0;s<i.length;s++){if(0==i[s].maxPoints){if(0==i[s].studentPoints)continue;i[s].maxPoints=1}l+=i[s].studentPoints,d+=i[s].maxPoints}return l/d},calculateCategoryGrades:function(t){for(var e=[],n=0;n<t.categoryPoints.length;n++){if(e[n]=[],0==t.categoryPoints[n].maxPoints){if(0==t.categoryPoints[n].studentPoints)continue;t.categoryPoints[n].maxPoints=1}e[n][0]=t.categoryPoints[n].studentPoints/t.categoryPoints[n].maxPoints,e[n][1]=t.categoryPoints[n].cat}return e}},Builder=function(t){t.builder=this,t.built=!0,this.dataRef=t,this.assignmentTbl=Retriever.getAssignmentTbl(),this.deleteButtons=[],this.realTrashHolder=document.createElement("div"),this.realTrash=[],this.fakeTrashHolder=document.createElement("div"),this.fakeTrash=[],this.contentHolder=document.createElement("div"),this.rightContentDiv=document.body.appendChild(document.createElement("div")),this.rightContentDiv.width=350,this.rightContentDiv.style.width=this.rightContentDiv.width+"px",this.rightContentDiv.style.position="fixed",this.rightContentDiv.style.left=window.innerWidth-this.rightContentDiv.width+"px",this.rightContentDiv.style.top="0px",this.rightContentDiv.style.backgroundColor="#FAF6DA",this.rightContentDiv.style.padding="5px",this.rightContentDiv.style.zIndex=9999999,this.bottomContentDiv=document.body.appendChild(document.createElement("div")),this.bottomContentDiv.width=window.innerWidth,this.bottomContentDiv.style.width=this.bottomContentDiv.width+"px",this.bottomContentDiv.height=50;var e,n=document.createElement("div");n.style.height=this.bottomContentDiv.height+"px",document.body.appendChild(n),this.bottomContentDiv.style.height=this.bottomContentDiv.height+"px",this.bottomContentDiv.style.position="fixed",this.bottomContentDiv.style.top=window.innerHeight-this.bottomContentDiv.height+"px",this.bottomContentDiv.style.left="0px",this.bottomContentDiv.style.padding="5px",this.bottomContentDiv.style.backgroundColor="#FAF6DA",this.bottomContentDiv.style.zIndex=9999999,this.calculateGradeButton=this.rightContentDiv.appendChild(document.createElement("input")),this.calculateGradeButton.type="button",this.calculateGradeButton.value="Calculate my grade with these categories:",this.calculateGradeButton.builder=this,this.categoryDiv=this.rightContentDiv.appendChild(document.createElement("div")),this.categoryChecks=[],this.categoryContainers=[],this.categoryGrades=[],this.addCategory=function(t){var e=this.categoryContainers.push(this.rightContentDiv.appendChild(document.createElement("span")))-1,n=this.categoryChecks.push(this.categoryContainers[e].appendChild(document.createElement("input")))-1;this.categoryChecks[n].type="checkbox",this.categoryChecks[n].id=t,this.categoryChecks[n].checked=!0,this.categoryContainers[e].innerHTML+=t+" - ";var i=this.categoryGrades.push(document.createElement("span"))-1;this.categoryGrades[i]=this.categoryContainers[e].appendChild(this.categoryGrades[i]),this.categoryGrades[i].innerHTML="%",this.categoryGrades[i].id=t+"grade",this.categoryContainers[e].innerHTML+="<br/>"};for(var i=0;i<t.categoryPoints.length;i++)this.addCategory(t.categoryPoints[i].cat);this.currentGradeDisplay=document.createElement("span"),this.rightContentDiv.appendChild(this.currentGradeDisplay),this.updateTotalGradeDisplay=function(t){t=Math.round(1e4*t)/100,this.currentGradeDisplay.innerHTML="Grade: "+t+"%<br/>"},this.updateTotalGradeDisplay(DataHandling.calculateTotalGrade(t,!1)),this.updateCategoryGradeDisplays=function(t,e){for(var n=0;n<t.length;n++){var i=t[n];i[0]||((i=[])[0]=0),i=Math.round(1e4*(i=i[0]))/100;var s="string"==typeof e[n].weight?"":e[n].weight+"% - ";this.categoryGrades[n].innerHTML=s+i+"%"}},this.updateCategoryGradeDisplays(DataHandling.calculateCategoryGrades(this.dataRef),this.dataRef.categoryPoints),this.calculateGradeClicked=function(){var t=DataHandling.calculateTotalGrade(this.builder.dataRef,!0,this.builder);this.builder.updateTotalGradeDisplay(t)},this.calculateGradeButton.onclick=this.calculateGradeClicked,this.newAssignmentDiv=this.bottomContentDiv.appendChild(document.createElement("div")),this.newAssignmentDiv.id="newAssignmentDiv",this.newAssignmentDiv.innerHTML+="<b>New Assignment:</b> Category: ",this.categorySelection=this.newAssignmentDiv.appendChild(document.createElement("select"));for(var i=0;i<this.dataRef.categoryPoints.length;i++)(e=document.createElement("option")).text=this.dataRef.categoryPoints[i].cat,this.categorySelection.add(e);this.categorySelection.id="categorySelection",this.categorySelection.builder=this,this.newAssignmentDiv.innerHTML+=" Assignment Name: ",this.newAssignmentNameTextField=this.newAssignmentDiv.appendChild(document.createElement("input")),this.newAssignmentNameTextField.type="text",this.newAssignmentNameTextField.id="newAssignmentNameTextField",this.newAssignmentNameTextField.builder=this,this.newAssignmentDiv.innerHTML+=" Max Score: ",this.newAssignmentMaxScoreField=this.newAssignmentDiv.appendChild(document.createElement("input")),this.newAssignmentMaxScoreField.type="number",this.newAssignmentMaxScoreField.builder=this,this.newAssignmentMaxScoreField.id="newAssignmentMaxScoreField",this.newAssignmentDiv.innerHTML+=" Your Projected Score: ",this.newAssignmentStudentScoreField=this.newAssignmentDiv.appendChild(document.createElement("input")),this.newAssignmentStudentScoreField.type="number",this.newAssignmentStudentScoreField.builder=this,this.newAssignmentStudentScoreField.id="newAssignmentStudentScoreField",this.newAssignmentDiv.innerHTML+="  ",this.newAssignmentAddButton=this.newAssignmentDiv.appendChild(document.createElement("input")),this.newAssignmentAddButton.type="button",this.newAssignmentAddButton.value="Add",this.newAssignmentAddButton.builder=this,this.newAssignmentAddButton.id="newAssignmentAddButton",this.addAssignment=function(t,e,n,i){var s=document.createElement("tr");s.style.backgroundColor="#EDF2F8",s.innerHTML='<td><div class="float_l padding_r5" style="min-width: 105px;">'+t+'<br><a href="" title='+e+">"+e+'</div></td><td style="width:100%;"></td><td>FakeDate<br></td><td nowrap=""><div>Score: '+n+"</div>"+n+" / "+i+" = "+Math.round(n/i*1e4)/100+'%</td><td class="list_text"><div style="width: 125px;"></div></td>',this.assignmentTbl.appendChild(s)},this.addAssignmentButtonClicked=function(){var t=this.builder.categorySelection.value,e=this.builder.newAssignmentNameTextField.value,n=this.builder.newAssignmentStudentScoreField.value,i=this.builder.newAssignmentMaxScoreField.value;this.builder.addAssignment(t,e,n,i),this.builder.dataRef.reset(),this.builder.reset()},this.newAssignmentAddButton.onclick=this.addAssignmentButtonClicked,this.deleteButtonClicked=function(){this.builder.deleteAssignment(this.rowNumber,this.builder),this.builder.dataRef.reset(),this.builder.reset()},this.createDeleteButtons=function(){for(var t=0;t<this.deleteButtons.length;t++)this.deleteButtons[t].parentNode.removeChild(this.deleteButtons[t]);this.deleteButtons=[];for(var t=0;t<this.assignmentTbl.children.length;++t){var e=Retriever.getAssignmentNameElement(this.assignmentTbl.children[t]);this.deleteButtons[t]=e.appendChild(document.createElement("input")),this.deleteButtons[t].type="button",this.deleteButtons[t].value="Delete",this.deleteButtons[t].rowNumber=t,this.deleteButtons[t].builder=this,this.deleteButtons[t].onclick=this.deleteButtonClicked}},this.createDeleteButtons(),this.deleteAssignment=function(t,e){var n=e.assignmentTbl.children[t];e.realTrash.push(e.realTrashHolder.appendChild(n))},this.newAssignmentButtonClicked=function(){alert("fuck")},this.loadButtons=[],this.upcomingAssignmentDiv=[],this.upcAssDiv=document.createElement("div"),this.upcAssDiv.id="upcomingAssignmentDiv",document.body.appendChild(this.upcAssDiv),this.buildNewAssignments=function(){this.upcAssDiv=document.getElementById("upcomingAssignmentDiv");var t=this.upcAssDiv;t.width=325,t.height=400,t.style.width=t.width+"px",t.style.height=t.height+"px",t.style.position="fixed",t.style.left="0px",t.style.top="0px",t.style.backgroundColor="#FAF6DA",t.style.padding="5px",t.style.zIndex=9999999,t.style.overflowY="auto",t.style.wordWrap="break-word",t.innerHTML="<p style = 'font-size:20px;'>Upcoming Assignments:</p>";for(var e=this.dataRef.newAssignments,n=0;n<e.length;n++){t.innerHTML+="<br/>";var i=document.createElement("input");i.type="button",i.value="Load",i.onclick=function(){alert("why?")},console.log(i),t.appendChild(i)}},this.reset=function(){this.assignmentTbl=Retriever.getAssignmentTbl(),this.newAssignmentDiv=document.getElementById(this.newAssignmentDiv.id),this.categorySelection=document.getElementById(this.categorySelection.id),this.newAssignmentNameTextField=document.getElementById(this.newAssignmentNameTextField.id),this.newAssignmentMaxScoreField=document.getElementById(this.newAssignmentMaxScoreField.id),this.newAssignmentStudentScoreField=document.getElementById(this.newAssignmentStudentScoreField.id),this.newAssignmentAddButton=document.getElementById(this.newAssignmentAddButton.id);for(var t=0;t<this.categoryChecks.length;t++){var e=this.categoryChecks[t].checked;this.categoryChecks[t]=document.getElementById(this.categoryChecks[t].id),this.categoryChecks[t].checked=e}for(var t=0;t<this.categoryGrades.length;t++)this.categoryGrades[t]=document.getElementById(this.categoryGrades[t].id);this.updateTotalGradeDisplay(DataHandling.calculateTotalGrade(this.dataRef,!0,this)),this.updateCategoryGradeDisplays(DataHandling.calculateCategoryGrades(this.dataRef),this.dataRef.categoryPoints),this.createDeleteButtons()}},StudentClassData=function(){this.newAssignments=!1,this.built=!1,this.builder,this.weights=Retriever.scoresCategoryCollection(),this.assignments=Retriever.getAssignmentCollection(),this.categoryPoints=DataHandling.findCategoryPointsOf(this.assignments,this.weights),this.totalWeight=DataHandling.findTotalWeightOf(this.weights),this.reset=function(){this.weights=Retriever.scoresCategoryCollection(),this.assignments=Retriever.getAssignmentCollection(),this.categoryPoints=DataHandling.findCategoryPointsOf(this.assignments,this.weights),this.totalWeight=DataHandling.findTotalWeightOf(this.weights)},this.loadedNewAssignments=function(){this.built&&this.builder.buildNewAssignments()},Retriever.getNewAssignments(this)},studentData=new StudentClassData,builder=new Builder(studentData);builder.reset();
